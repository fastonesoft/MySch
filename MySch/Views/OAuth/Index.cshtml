@{
    Layout = null;
    long t = DateTime.Now.Ticks;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>校务在线</title>
    <link rel="stylesheet" href="~/Content/wxstyle.css?t=@t" />
    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.1.0.js"></script>

    <link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/1.1.0/weui.min.css">
    <script type="text/javascript" src="https://res.wx.qq.com/open/libs/weuijs/1.1.1/weui.min.js"></script>

    <script src="~/Scripts/jquery-1.12.4.min.js"></script>

    <script type="text/javascript">
        $(function(){
            wx.config({
                debug: false,
                appId: '@ViewBag.appid',
                timestamp: @ViewBag.timestamp,
                nonceStr: '@ViewBag.noncestr',
                signature: '@ViewBag.signature',
                jsApiList: [
                  'checkJsApi',
                  'hideMenuItems',
                  'hideAllNonBaseMenuItem',
                  'translateVoice',
                  'chooseImage',
                  'previewImage',
                  'uploadImage',
                  'hideOptionMenu',
                  'closeWindow',
                  'scanQRCode',
                  'chooseWXPay',
                  //'downloadImage',
                  //'onMenuShareTimeline',
                  //'onMenuShareAppMessage',
                  //'onMenuShareQQ',
                  //'onMenuShareWeibo',
                  //'onMenuShareQZone',
                  //'showMenuItems',
                  //'showAllNonBaseMenuItem',
                  //'startRecord',
                  //'stopRecord',
                  //'onVoiceRecordEnd',
                  //'playVoice',
                  //'onVoicePlayEnd',
                  //'pauseVoice',
                  //'stopVoice',
                  //'uploadVoice',
                  //'downloadVoice',
                  //'getNetworkType',
                  //'openLocation',
                  //'getLocation',
                  //'showOptionMenu',
                  //'openProductSpecificView',
                  //'addCard',
                  //'chooseCard',
                  //'openCard',
                ]
            });

            wx.ready(function () {
                //隐藏所有非基本菜单项
                wx.hideAllNonBaseMenuItem({
                    success: function () {
                        //alert('已隐藏所有非基本菜单项');
                    }
                });

                // 1 判断当前版本是否支持指定 JS 接口，支持批量判断
                document.querySelector('#checkJsApi').onclick = function () {
                    wx.checkJsApi({
                        jsApiList: [
                            'checkJsApi',
                            'hideMenuItems',
                            'hideAllNonBaseMenuItem',
                            'translateVoice',
                            'chooseImage',
                            'previewImage',
                            'uploadImage',
                            'downloadImage',
                            'hideOptionMenu',
                            'closeWindow',
                            'scanQRCode',
                            'chooseWXPay',
                        ],
                        success: function (res) {
                            alert(JSON.stringify(res));
                        }
                    });
                };

                function upload(ids) {
                    for(i = 0; i < ids.length; i++)
                    {
                        wx.uploadImage({
                            localId: ids[i],
                            success: function (res) {
                                $.post('/OAuth/UploadImage',{ mediaID:res.serverId }, function(d){
                                    if(d.error)
                                    {
                                        alert(d.message);
                                    }
                                })
                            },
                            fail: function (res) {
                                alert(JSON.stringify(res));
                            }
                        });
                    }
                }

                //选择图片，上传
                document.querySelector('#chooseImage').onclick = function () {
                    wx.chooseImage({
                        success: function (res) {
                            upload(res.localIds);
                        }
                    });
                };

                // 5.2 图片预览
                document.querySelector('#previewImage').onclick = function () {
                    //获取列表
                    $.post('/OAuth/GetImages', function(images){
                        //读取已上传的图片列表
                        var current = images.length == 0 ? '' : images[images.length-1];
                        wx.previewImage({
                            current: current,
                            urls: images,
                        });
                    })
                };

                // 9 微信原生接口
                // 9.1.1 扫描二维码并返回结果
                document.querySelector('#scanQRCode0').onclick = function () {
                    wx.scanQRCode();
                };
                // 9.1.2 扫描二维码并返回结果
                document.querySelector('#scanQRCode1').onclick = function () {
                    wx.scanQRCode({
                        needResult: 1,
                        desc: 'scanQRCode desc',
                        success: function (res) {
                            alert(JSON.stringify(res));
                        }
                    });
                };
            });
        })


    </script>
</head>
<body>
    <div class="wxapi_container">
        <div class="lbox_close wxapi_form">

            <div class="weui-cells weui-cells_form">
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">手机号</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="tel" required="" pattern="^\d{11}$" maxlength="11" placeholder="输入你现在的手机号" emptytips="请输入手机号" notmatchtips="请输入正确的手机号">
                    </div>
                    <div class="weui-cell__ft"> <i class="weui-icon-warn"></i> </div>
                </div>
                <div class="weui-cell">
                    <div class="weui-cell__hd">
                        <label class="weui-label">身份证</label>
                    </div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" required="" pattern="REG_IDNUM" maxlength="18" placeholder="输入学生的身份证号" emptytips="请输入身份证号码" notmatchtips="请输入正确的身份证号码">
                    </div>
                    <div class="weui-cell__ft"> <i class="weui-icon-warn"></i> </div>
                </div>
            </div>

            <div class="weui-btn-area">
                <a id="formSubmitBtn" href="javascript:" class="weui-btn weui-btn_primary">提交</a>
            </div>

            <h3 id="menu-basic">基础接口</h3>
            <span class="desc">判断当前客户端是否支持指定JS接口</span>
            <button class="btn btn_primary" id="checkJsApi">checkJsApi</button>


            <h3 id="menu-image">图像接口</h3>
            <span class="desc">拍照或从手机相册中选图接口</span>
            <button class="btn btn_primary" id="chooseImage">chooseImage</button>
            <span class="desc">预览图片接口</span>
            <button class="btn btn_primary" id="previewImage">previewImage</button>

            <h3 id="menu-scan">微信扫一扫</h3>
            <span class="desc">调起微信扫一扫接口</span>
            <button class="btn btn_primary" id="scanQRCode0">scanQRCode(微信处理结果)</button>
            <button class="btn btn_primary" id="scanQRCode1">scanQRCode(直接返回结果)</button>


            <div style="display:none;">
                <h3 id="menu-pay">微信支付接口</h3>
                <span class="desc">发起一个微信支付请求</span>
                <button class="btn btn_primary" id="chooseWXPay">chooseWXPay</button>
            </div>
        </div>
    </div>
</body>
</html>
