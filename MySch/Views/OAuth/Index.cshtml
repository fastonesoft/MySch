@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>校务在线</title>
    <script src="~/Scripts/jquery-1.12.4.min.js"></script>

    <script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.1.0.js"></script>

    <link rel="stylesheet" href="https://res.wx.qq.com/open/libs/weui/1.1.2/weui.min.css">
    <script type="text/javascript" src="https://res.wx.qq.com/open/libs/weuijs/1.1.1/weui.min.js"></script>
    <script type="text/javascript">
        $(function () {
            wx.config({
                debug: false,
                @*appId: '@ViewBag.appid',
                timestamp: @ViewBag.timestamp,
                nonceStr: '@ViewBag.noncestr',
                signature: '@ViewBag.signature',*@
                jsApiList: [
                  'checkJsApi',
                  'hideMenuItems',
                  'hideAllNonBaseMenuItem',
                  'translateVoice',
                  'chooseImage',
                  'previewImage',
                  'uploadImage',
                  'hideOptionMenu',
                  'closeWindow',
                  'scanQRCode',
                  'chooseWXPay',
                  //'downloadImage',
                  //'onMenuShareTimeline',
                  //'onMenuShareAppMessage',
                  //'onMenuShareQQ',
                  //'onMenuShareWeibo',
                  //'onMenuShareQZone',
                  //'showMenuItems',
                  //'showAllNonBaseMenuItem',
                  //'startRecord',
                  //'stopRecord',
                  //'onVoiceRecordEnd',
                  //'playVoice',
                  //'onVoicePlayEnd',
                  //'pauseVoice',
                  //'stopVoice',
                  //'uploadVoice',
                  //'downloadVoice',
                  //'getNetworkType',
                  //'openLocation',
                  //'getLocation',
                  //'showOptionMenu',
                  //'openProductSpecificView',
                  //'addCard',
                  //'chooseCard',
                  //'openCard',
                ]
            });

            wx.ready(function () {
                //隐藏所有非基本菜单项
                wx.hideAllNonBaseMenuItem({
                    success: function () {
                        //alert('已隐藏所有非基本菜单项');
                    }
                });

                var reg = {
                    IDNUM: /^\d{17}[\dxX]$/,
                    TEL: /^1(3\d|4[57]|5[0-35-9]|8\d|70)\d{8}$/
                };
                //表单
                $('#oa_stud_reg_upload').click(function () {
                    weui.form.validate('#oa_stud_reg', function (error) {
                        if (!error) {
                            var loading = weui.loading('提交中...');
                            setTimeout(function () {
                                loading.hide();
                                weui.toast('提交成功', 3000);
                            }, 1500);
                        } else {
                            //alert(JSON.stringify(error));
                            //weui.topTips(error, 3000);
                        }
                    }, {
                        regexp: reg
                    });
                });

                weui.form.checkIfBlur('#oa_stud_reg', {
                    regexp: reg
                });

                var syncUpload = function (localIds) {
                    var localId = localIds.pop();
                    wx.uploadImage({
                        localId: localId,
                        isShowProgressTips: 1,
                        success: function (res) {
                            //对serverId做处理的代码
                            $.post('/OAuth/UploadImage', { mediaID: res.serverId }, function (d) {
                                if (d.error) {
                                    alert(d.message);
                                }
                            })
                            if (localIds.length > 0) {
                                syncUpload(localIds);
                            }
                        }
                    });
                }

                //选择图片，上传
                $('.oa-upload .weui-btn').click(function () {
                    //分类名称
                    var name = $(this).text();
                    wx.chooseImage({
                        success: function (res) {
                            //TODO,添加分类
                            syncUpload(res.localIds);
                        }
                    });
                });

                // 5.2 图片预览
                document.querySelector('#previewImage').onclick = function () {
                    //获取列表
                    $.post('/OAuth/GetImages', function (images) {
                        //读取已上传的图片列表
                        if (images.length == 0) {
                            alert('您还没有上传图片');
                        } else {
                            var current = images[images.length - 1];
                            wx.previewImage({
                                current: current,
                                urls: images,
                            });
                        }
                    })
                };

                // 9 微信原生接口
                // 9.1.1 扫描二维码并返回结果
                document.querySelector('#scanQRCode0').onclick = function () {
                    wx.scanQRCode();
                };
                // 9.1.2 扫描二维码并返回结果
                document.querySelector('#scanQRCode1').onclick = function () {
                    wx.scanQRCode({
                        needResult: 1,
                        desc: 'scanQRCode desc',
                        success: function (res) {
                            alert(JSON.stringify(res));
                        }
                    });
                };

            });
        })


    </script>
</head>
<body ontouchstart>
    <form id="oa_stud_reg">
        <div class="weui-article">
            <h1 class="weui_cells_title">学生注册</h1>
            <div class="weui-cells weui-cells_form">
                <div class="weui-cell">
                    <div class="weui-cell__hd"><label class="weui-label">身份证号</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="text" required="required" pattern="REG_IDNUM" maxlength="18" placeholder="输入学生的身份证号" emptytips="学生身份证号不能为空" notmatchtips="身份证号码不正确">
                    </div>
                    <div class="weui-cell__ft"> <i class="weui-icon-warn"></i> </div>
                </div>
                <div class="weui-cell">
                    <div class="weui-cell__hd"><label class="weui-label">手机号码</label></div>
                    <div class="weui-cell__bd">
                        <input class="weui-input" type="tel" required="required" pattern="REG_TEL" maxlength="11" placeholder="输入你现在的手机号" emptytips="手机号码不能为空" notmatchtips="手机号码不正确">
                    </div>
                    <div class="weui-cell__ft"> <i class="weui-icon-warn"></i> </div>
                </div>
            </div>
            <div class="weui-btn-area oa-reg">
                <a id="oa_stud_reg_upload" href="javascript:" class="weui-btn weui-btn_primary">提交</a>
            </div>
        </div>
    </form>

    <div class="weui-article oa-upload" id="oa_stud_reged" style="margin-bottom: 15px;">
        <h1>学生姓名</h1>
        <img src="~/Image/code?content=321284200508150254" />
        <h2>　　你已完成报名注册，请到报名窗口出示条形码，审核报名所需的相关资料原件</h2>
        <h2>　　也可以对照下列选项，先上传报名原件的照片，再去窗口审核</h2>
        <div class="weui-btn-area">
            <a href="javascript:" class="weui-btn weui-btn_primary">毕业证</a>
        </div>
        <div class="weui-btn-area">
            <a href="javascript:" class="weui-btn weui-btn_primary">产权证</a>
        </div>
        <div class="weui-btn-area">
            <a href="javascript:" class="weui-btn weui-btn_primary">户口簿</a>
        </div>
        <div class="weui-btn-area">
            <a href="javascript:" class="weui-btn weui-btn_primary">补充协议书</a>
        </div>
    </div>


    <div class="wxapi_container" style="display:none;">

        <div class="lbox_close wxapi_form">


            <h3 id="menu-image">图像接口</h3>
            <span class="desc">拍照或从手机相册中选图接口</span>
            <button class="btn btn_primary" id="chooseImage">选择本机图片</button>
            <span class="desc">预览图片接口</span>
            <button class="btn btn_primary" id="previewImage">上传图片预览</button>

            <h3 id="menu-scan">微信扫一扫</h3>
            <span class="desc">调起微信扫一扫接口</span>
            <button class="btn btn_primary" id="scanQRCode0">scanQRCode(微信处理结果)</button>
            <button class="btn btn_primary" id="scanQRCode1">scanQRCode(直接返回结果)</button>


            <div style="display:none;">
                <h3 id="menu-pay">微信支付接口</h3>
                <span class="desc">发起一个微信支付请求</span>
                <button class="btn btn_primary" id="chooseWXPay">chooseWXPay</button>
            </div>
        </div>
    </div>
</body>
</html>
